(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5b72"],{"9F13":function(e,t,i){},DRGK:function(e,t,i){"use strict";i.r(t);var a=i("gDS+"),n=i.n(a),r=i("EVdn"),o=i.n(r),s=(i("rY9o"),i("uBC2"),i("Mz3J")),l=i("t3Un"),c=(i("L2JU"),i("N9E5")),u=i("Q2AE"),d={inserted:function(e,t,i){var a=t.value,n=u.a.getters&&u.a.getters.roles;if(!(a&&a instanceof Array&&a.length>0))throw new Error("need roles! Like v-permission=\"['admin','editor']\"");var r=a;n.some(function(e){return r.includes(e)})||e.parentNode&&e.parentNode.removeChild(e)}},p=function(e){e.directive("permission",d)};window.Vue&&(window.permission=d,Vue.use(p)),d.install=p;var g={inject:["reload"],directives:{permission:d},components:{Pagination:s.a},filters:{statusFilter:function(e){var t="";switch(e){case"进行中":t="in_progress";break;case"结束":t="completed"}return{in_progress:"success",completed:"danger"}[t]}},data:function(){return{list:null,listStore:null,flag:1,listLoading:!0,editProgram:{areaAdmin:"",projectLeader:""},partsList:[],curProgram:null,curProgramIndex:0,areaManagerArr:[],projectLeaderArr:[],listQuery:{page:1,limit:20,projectId:void 0,projectName:void 0},total:0,dialogFormVisible:!1,dialogListVisible:!1,currentEditRow:{projectId:"001",projectName:"挖掘机项目",boxList:["吊篮1","吊篮2","吊篮3"]},buttonText:"待财务部通过"}},created:function(){this.fetchData(),this.listLoading=!1},methods:{checkPermission:function(e){var t=!1;return c.a.userRoles.forEach(function(i,a,n){e.forEach(function(e,a,n){i!==e||(t=!0)})}),t},fetchData:function(){var e=this;o.a.ajax({type:"GET",url:l.a.BASEURL+"/projectInfo",xhrFields:{withCredentials:!0},headers:{Authorization:localStorage.getItem("token")},data:"userFlag="+this.flag,success:function(t){console.log(t),t.projectList?(e.list=t.projectList,e.total=e.list.length,e.listStore=e.list):!1===t.isAllowed&&alert("您没有权限访问！")},error:function(e){console.log(e.status)}})},getBasketAssignment:function(e,t){var i=this;this.dialogListVisible=!0,this.curProgram=e,console.log(e.projectId),o.a.ajax({type:"GET",url:l.a.BASEURL+"/getConfigurationList",xhrFields:{withCredentials:!0},headers:{Authorization:localStorage.getItem("token")},data:"projectId="+e.projectId,success:function(e){console.log("吊篮配件清单",e),!0===e.isAllowed?"success"===e.get&&e.partsList&&(i.partsList=e.partsList,i.list[t].partsList=e.partsList):i.$message({type:"danger",message:"您没有权限！"})},error:function(e){console.log(e.status)}})},basketAssignmentPass:function(){var e=this;this.dialogListVisible=!1;var t={projectId:this.curProgram.projectId,partsList:this.curProgram.partsList};o.a.ajax({type:"POST",url:l.a.BASEURL+"/handleConfigurationList",headers:{Authorization:localStorage.getItem("token")},xhrFields:{withCredentials:!0},contentType:"application/json",data:n()(t),success:function(t){console.log("财务部通过",t),!0===t.isAllowed?"success"===t.pass?(e.buttonText="已通过",e.$message({type:"success",message:"操作成功"})):e.$message({type:"message",message:"写入数据库失败！"}):e.$message({type:"danger",message:"您没有权限！"})},error:function(e){console.log(e.status)}})},handleFilter:function(){var e=[],t=this.listQuery.projectId,i=this.listQuery.projectName;t||i?(void 0!=t&&void 0!=i?this.list.forEach(function(a,n){-1!==a.projectId.indexOf(t)&&-1!==a.projectName.indexOf(i)&&e.push(a)}):t?this.list.forEach(function(i,a){-1!==i.projectId.indexOf(t)&&e.push(i)}):i&&this.list.forEach(function(t,a){-1!==t.projectName.indexOf(i)&&e.push(t)}),this.list=e):this.list=this.listStore},handleUpdate:function(e,t){this.curProgram=e,this.curProgramIndex=t,this.dialogFormVisible=!0},handleDelete:function(e,t){this.list.splice(t,1)},getAreaManagerList:function(){var e=this;o.a.ajax({type:"GET",url:l.a.BASEURL+"/getAreaList",headers:{Authorization:localStorage.getItem("token")},xhrFields:{withCredentials:!0},success:function(t){!1===t.isLogin&&(e.$message({message:"您的登录已失效，请重新登录！",type:"warning"}),e.$router.push({path:"/login"}));var i=t.resultList;console.log(i),e.areaManagerArr=i},error:function(e){console.log(e.status)}})},queryProjectLeader:function(e){var t=this;""!==e&&o.a.ajax({type:"GET",url:l.a.BASEURL+"/getUserByPhoneOrName",headers:{Authorization:localStorage.getItem("token")},xhrFields:{withCredentials:!0},data:"information="+e,success:function(e){console.log("queryProjectLeader",e),t.projectLeaderArr=e.User},error:function(e){console.log(e.status)}})},handleAssign:function(){var e=this,t=this.editProgram.areaAdmin.split(" "),i=t[0],a=(t[1],this.editProgram.projectLeader.split(" ")),r=(a[0],a[1],a[2]),s={projectId:this.curProgram.projectId,adminAreaId:i,adminProjectId:r};console.log("information",s),o.a.ajax({type:"POST",url:l.a.BASEURL+"/editProjectDepartment",headers:{Authorization:localStorage.getItem("token")},xhrFields:{withCredentials:!0},contentType:"application/json",data:n()(s),success:function(t){console.log(t),!0===t.isEdit&&(e.$message({message:"编辑工程项目部成功！",type:"success"}),e.reload())},error:function(e){console.log(e.status)}}),this.dialogFormVisible=!1}}},m=(i("OEO/"),i("KHd+")),f=Object(m.a)(g,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"项目号"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleFilter(t):null}},model:{value:e.listQuery.projectId,callback:function(t){e.$set(e.listQuery,"projectId",t)},expression:"listQuery.projectId"}}),e._v(" "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"项目名称"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleFilter(t):null}},model:{value:e.listQuery.projectName,callback:function(t){e.$set(e.listQuery,"projectName",t)},expression:"listQuery.projectName"}}),e._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v("Search")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"项目ID",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.projectId)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"项目名称",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.projectName)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"吊篮列表",width:"125",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row.boxList,function(t){return i("div",[e._v(e._s(t))])}),e._v(" "),i("span",{staticClass:"list",on:{click:function(i){e.getBasketAssignment(t.row,t.$index)}}},[e._v("吊篮配置清单"),i("i",{staticClass:"el-icon-view el-icon--right"})])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"工程项目部",width:"110",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[e._v("区域管理员：")]),e._v(" "),i("span",[e._v(e._s(t.row.adminAreaUser.userName))]),e._v(" "),i("div",[e._v("项目负责人：")]),e._v(" "),i("span",[e._v(e._s(t.row.adminProjectUser.userName))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"租方管理员",width:"110",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.adminRentUser.userName))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"作业人员列表",width:"110",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.projectBuilders,function(t){return i("div",[e._v(e._s(t))])})}}])}),e._v(" "),i("el-table-column",{attrs:{"class-name":"status-col",label:"状态",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tag",{attrs:{type:e._f("statusFilter")(t.row.projectState)}},[e._v(e._s(t.row.projectState))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",prop:"created_at",label:"开始日期",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-time"}),e._v(" "),i("span",[e._v(e._s(t.row.projectStart))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",prop:"created_at",label:"结束日期",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-time"}),e._v(" "),i("span",[e._v(e._s(t.row.projectEnd))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{disabled:!e.checkPermission(["superWebAdmin","engineeringWebAdmin"]),type:"primary",size:"mini"},on:{click:function(i){e.handleUpdate(t.row,t.$index)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{disabled:!e.checkPermission(["superWebAdmin"]),type:"danger",size:"mini"},on:{click:function(i){e.handleDelete(t.row,t.$index)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("el-dialog",{attrs:{title:"成立工程项目部",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{attrs:{model:e.editProgram}},[i("el-form-item",{attrs:{label:"区域管理员","label-width":"120px"}},[i("el-select",{attrs:{filterable:"",placeholder:"请选择区域管理员"},on:{focus:function(t){e.getAreaManagerList()}},model:{value:e.editProgram.areaAdmin,callback:function(t){e.$set(e.editProgram,"areaAdmin",t)},expression:"editProgram.areaAdmin"}},e._l(e.areaManagerArr,function(e){return i("el-option",{attrs:{label:e.userId+" "+e.userName,value:e.userId+" "+e.userName}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"项目负责人","label-width":"120px"}},[i("el-select",{attrs:{filterable:"",remote:"",placeholder:"请搜索项目负责人","remote-method":e.queryProjectLeader},model:{value:e.editProgram.projectLeader,callback:function(t){e.$set(e.editProgram,"projectLeader",t)},expression:"editProgram.projectLeader"}},e._l(e.projectLeaderArr,function(e){return i("el-option",{key:e.userPhone+" "+e.userName+" "+e.userId,attrs:{label:e.userPhone+" "+e.userName+" "+e.userId,value:e.userPhone+" "+e.userName+" "+e.userId}})}))],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleAssign()}}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"吊篮配置清单",visible:e.dialogListVisible,"custom-class":"details"},on:{"update:visible":function(t){e.dialogListVisible=t}}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.partsList}},[i("el-table-column",{attrs:{prop:"part",align:"center",label:"配件名称"}}),e._v(" "),i("el-table-column",{attrs:{prop:"unit",align:"center",label:"单位",width:"180"}}),e._v(" "),i("el-table-column",{attrs:{prop:"quantity",align:"center",label:"数量",width:"180"}})],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{id:"accountingButton",disabled:!e.checkPermission(["superWebAdmin","accountingWebAdmin"]),type:"primary"},on:{click:function(t){e.basketAssignmentPass()}}},[e._v(e._s(e.buttonText))])],1)],1),e._v(" "),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{"update:page":function(t){e.$set(e.listQuery,"page",t)},"update:limit":function(t){e.$set(e.listQuery,"limit",t)}}})],1)},[],!1,null,"15deb94a",null);f.options.__file="index.vue";t.default=f.exports},Mz3J:function(e,t,i){"use strict";Math.easeInOutQuad=function(e,t,i,a){return(e/=a/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t};var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};function n(e,t,i){var n=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,r=e-n,o=0;t=void 0===t?500:t;!function e(){o+=20,function(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}(Math.easeInOutQuad(o,n,r,t)),o<t?a(e):i&&"function"==typeof i&&i()}()}var r={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&n(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&n(0,800)}}},o=(i("PelQ"),i("KHd+")),s=Object(o.a)(r,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[i("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},[],!1,null,"7d9f0a7c",null);s.options.__file="index.vue";t.a=s.exports},"OEO/":function(e,t,i){"use strict";var a=i("9F13");i.n(a).a},PelQ:function(e,t,i){"use strict";var a=i("X9ZH");i.n(a).a},X9ZH:function(e,t,i){},"gDS+":function(e,t,i){e.exports={default:i("oh+g"),__esModule:!0}},"oh+g":function(e,t,i){var a=i("WEpk"),n=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return n.stringify.apply(n,arguments)}},rY9o:function(e,t,i){"use strict";i("t3Un")}}]);